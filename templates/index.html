<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>配煤程序</title>

    <link href="/static/css/tailwind.min.css" rel="stylesheet">
    <link href="/static/css/font-awesome.min.css" rel="stylesheet">
    <script src="/static/js/chart.umd.min.js"></script>

    <style>
        /* ================== 基础样式 ================== */

        input[type="checkbox"] {
            accent-color: #2563eb;
        }

        tr.bg-blue-100 {
            background-color: #eff6ff !important;
        }

        button {
            white-space: nowrap;
        }

        input:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, .2);
        }

        /* 横向滚动容器（配比可视化用） */
        .coal-cards-container {
            overflow-x: auto;
            padding-bottom: 10px;
        }

        /* 原先用于渐变“水桶”的卡片，可保留备用 */
        .coal-card {
            transition: transform .15s ease;
        }

        .coal-card:hover {
            transform: translateY(-2px);
        }

        .scale-mark {
            position: absolute;
            right: 12px;
            width: 4px;
            height: 1px;
            background-color: #ccc;
        }

        /* 结果三列布局：标题 / 桶组 / 成本 + 按钮 */
        .plan-grid {
            display: grid;
            grid-template-columns: 180px 1fr minmax(340px, auto);
            gap: 12px;
            align-items: center;
        }

        @media (max-width: 768px) {
            .plan-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 成本/热值整体左移一点，避免挤到按钮 */
        .plan-metrics {
            transform: translateX(-180px);
        }

        /* ================== 电煤方案按钮样式 ================== */

        .plan-confirm-btn {
            border: 2px solid #22c55e; /* 绿色边框 */
            background: transparent;
            color: #6b7280; /* 灰色字体 */
            font-weight: bold;
            border-radius: 8px;
            display: flex;
            align-items: center;
            transition: 0.25s ease;
            padding: 16px 18px; /* 高度加倍 */
            height: 64px; /* 显式高度 */
            font-size: 18px;
        }

        .plan-confirm-btn i {
            color: #22c55e;
            margin-right: 8px;
        }

        .plan-confirm-btn:hover {
            background: #22c55e;
            color: #ffffff;
        }

        .plan-confirm-btn:hover i {
            color: #ffffff;
        }

        /* ================== 桶形煤卡（电煤配比用） ================== */

        .coal-oil-tank-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .coal-oil-tank {
            position: relative;
            width: 120px;
            height: 108px;
            border-radius: 60px / 14px; /* 顶部椭圆 */
            background: linear-gradient(to bottom, #f8fafc, #e2e8f0);
            border: 3px solid #cbd5e1;
            overflow: hidden;
            box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.10);
        }

        /* 顶部内壁高光（内侧弧线效果） */
        .coal-oil-tank::before {
            content: "";
            position: absolute;
            top: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 92%;
            height: 14px;
            background: radial-gradient(
                    ellipse at center,
                    rgba(0, 0, 0, 0.18) 0%,
                    rgba(0, 0, 0, 0.10) 45%,
                    rgba(0, 0, 0, 0.00) 100%
            );
            border-radius: 50%;
            z-index: 2;
            pointer-events: none;
        }

        /* 桶内水位填充 */
        .coal-oil-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 0;
            background: linear-gradient(to top, #aab1b8, #a9aeb7);
            transition: height .35s ease-out;
            z-index: 1;
        }

        /* 水面椭圆：跟着水位顶部走 */
        .coal-oil-water-top {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 92%;
            height: 12px;
            bottom: 0;

            background: radial-gradient(
                    ellipse at center,
                    rgba(180, 185, 190, 0.35) 0%,
                    rgba(200, 205, 210, 0.20) 45%,
                    rgba(220, 225, 230, 0.10) 70%,
                    rgba(240, 245, 250, 0) 100%
            );
            border-radius: 50%;
            pointer-events: none;
            z-index: 3;
        }

        /* 桶内文字：显示名称 + 比例 */
        .coal-oil-content {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            text-align: center;
            z-index: 4;
            color: #111827;
            padding: 0 4px;
        }

        .coal-oil-name {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .coal-oil-pct {
            font-size: 18px;
            font-weight: 700;
            color: #2563eb;
        }

        .coal-oil-calorific {
            font-size: 13px;
            color: #4b5563;
            margin-top: 4px;
        }

        /* 展开详情按钮 */
        .detail-toggle-btn {
            display: inline-flex;
            align-items: center;
            color: #6f98f4; /* 蓝色品牌色 */
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            transition: color .2s ease;
            margin-top: 8px;
        }

        .detail-toggle-btn:hover {
            color: #1e40af; /* 深一点的蓝色 */
        }

        /* 小图标动画 */
        .detail-toggle-btn i {
            margin-right: 6px;
            transition: transform .25s ease;
        }

        /* 展开时旋转图标 */
        .detail-toggle-btn.expanded i {
            transform: rotate(180deg);
        }

        /* 详情区域动画（可选） */
        .detail-box {
            transition: all .25s ease;
            overflow: hidden;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
<header class="bg-blue-600 text-white p-4">
    <div class="container mx-auto">
        <h1 class="text-2xl md:text-3xl font-bold" style="display:flex; align-items:center;">
            <img src="/static/logo.png" style="width:170px; height:auto; margin-right:16px;margin-left: 20px;">
            配煤程序
        </h1>
    </div>
</header>

<main class="container mx-auto p-4 md:p-6 flex-1">
    <!-- 标签页导航 -->
    <div class="flex border-b border-gray-200 mb-6">
        <button id="tab-electric" class="tab-btn py-2 px-4 border-b-2 border-blue-500 text-blue-600 font-medium">
            <i class="fa fa-bolt mr-2"></i>电煤计算
        </button>
        <button id="tab-coal" class="tab-btn py-2 px-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
            <i class="fa fa-coffee mr-2"></i>原煤管理
        </button>
        <button id="tab-blend"
                class="tab-btn py-2 px-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
            <i class="fa fa-calculator mr-2"></i>配煤计算-待完善
        </button>
        <button id="tab-result"
                class="tab-btn py-2 px-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
            <i class="fa fa-bar-chart mr-2"></i>计算结果-待完善
        </button>
    </div>

    <!-- 原煤管理面板 -->
    <div id="panel-coal" class="tab-panel hidden">
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <h2 class="text-xl font-semibold mb-4">添加原煤</h2>
            <form id="coal-form" class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div>
                    <label class="block text-gray-700 mb-1">原煤名称</label>
                    <select id="coal-name" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 cursor-pointer">
                        <option value="A煤">A煤</option>
                        <option value="B煤">B煤</option>
                        <option value="F煤">F煤</option>
                        <option value="WB煤">WB煤</option>
                        <option value="F2煤">F2煤</option>
                        <option value="A-煤">A-煤</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">发热量 (大卡)</label>
                    <input type="number" id="coal-calorific" step="0.1" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <p id="coal-calorific-error" class="text-red-600 text-sm mt-1 hidden">请输入 1000–7200 范围内的数值</p>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">灰分 (%)</label>
                    <input type="number" id="coal-ash" step="0.01" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">硫分 (%)</label>
                    <input type="number" id="coal-sulfur" step="0.01" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">挥发份 (%)</label>
                    <input type="number" id="coal-volatile" step="0.01" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">回收率 (%)</label>
                    <input type="number" id="coal-recovery" step="0.01" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">G值</label>
                    <input type="number" id="coal-g_value" step="0.01" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">X值</label>
                    <input type="number" id="coal-x_value" step="0.01" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Y值</label>
                    <input type="number" id="coal-y_value" step="0.01" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">价格 (元/吨)</label>
                    <input type="number" id="coal-price" step="0.1" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">短倒费 (元/吨)</label>
                    <input type="number" id="coal-short-transport" step="0.1" value="0"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">过筛费 (元/吨)</label>
                    <input type="number" id="coal-screening-fee" step="0.1" value="0"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">破碎费 (元/吨)</label>
                    <input type="number" id="coal-crushing-fee" step="0.1" value="0"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">是否境内煤</label>
                    <select id="coal-is-domestic" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="1" selected>是</option>
                        <option value="0" >否</option>
                    </select>
                </div>
                <div class="flex items-center space-x-3 md:col-span-2 pt-2">
                    <button id="coal-submit-btn" type="submit"
                            class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex-shrink-0">
                        <i class="fa fa-plus mr-1"></i>添加
                    </button>
                    <button id="coal-delete-btn" type="button"
                            class="hidden bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 flex-shrink-0">
                        <i class="fa fa-trash mr-1"></i>删除
                    </button>
                    <button id="coal-cancel-btn" type="button"
                            class="hidden bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 flex-shrink-0">
                        <i class="fa fa-times mr-1"></i>取消编辑
                    </button>
                </div>
            </form>
        </div>

        <div class="bg-white rounded-lg shadow-md p-4">
            <h2 class="text-xl font-semibold mb-4">原煤列表</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                    <tr class="bg-gray-100">
                        <th class="py-2 px-4 border">名称</th>
                        <th class="py-2 px-4 border">发热量</th>
                        <th class="py-2 px-4 border">灰分</th>
                        <th class="py-2 px-4 border">硫分</th>
                        <th class="py-2 px-4 border">挥发份</th>
                        <th class="py-2 px-4 border">回收率</th>
                        <th class="py-2 px-4 border">G值</th>
                        <th class="py-2 px-4 border">X值</th>
                        <th class="py-2 px-4 border">Y值</th>
                        <th class="py-2 px-4 border">价格</th>
                        <th class="py-2 px-4 border">短倒费</th>
                        <th class="py-2 px-4 border">过筛费</th>
                        <th class="py-2 px-4 border">破碎费</th>
                        <th class="py-2 px-4 border">境内煤</th>
                    </tr>
                    </thead>
                    <tbody id="coal-table-body">
                    <!-- 原煤数据将通过JS动态加载 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 配煤计算面板 -->
    <div id="panel-blend" class="tab-panel hidden">
        <div class="bg-white rounded-lg shadow-md p-4">
            <h2 class="text-xl font-semibold mb-4">配煤目标设置</h2>
            <form id="blend-form" class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-1">最低发热量 (大卡)</label>
                    <input type="number" id="target-calorific" step="0.1" value="5500" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">最高灰分 (%)</label>
                    <input type="number" id="target-ash" step="0.01" value="13" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">最高硫分 (%)</label>
                    <input type="number" id="target-sulfur" step="0.01" value="0.8" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <button type="submit"
                        class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700">
                    <i class="fa fa-calculator mr-1"></i>计算最优配比
                </button>
            </form>
        </div>
    </div>

    <!-- 电煤计算面板 -->
    <div id="panel-electric" class="tab-panel">
        <div class="bg-white rounded-lg shadow-md p-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">电煤目标设置</h2>
                <div class="bg-gray-50 p-2 rounded-md">
                    <div class="flex space-x-6">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" name="step-size" value="1" class="step-checkbox mr-2 w-4 h-4">
                            <span class="text-gray-700">1%</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" name="step-size" value="5" class="step-checkbox mr-2 w-4 h-4">
                            <span class="text-gray-700">5%</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" name="step-size" value="10" class="step-checkbox mr-2 w-4 h-4"
                                   checked>
                            <span class="text-gray-700">10%</span>
                        </label>
                    </div>
                </div>
            </div>

            <form id="electric-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-1">目标发热量 (大卡)</label>
                        <input type="number" id="electric-calorific" step="0.1" value="5000" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <p id="electric-calorific-error" class="text-red-600 text-sm mt-1 hidden">请输入 1000–7200 范围内的数值</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">选择参与配比的原煤</label>
                        <!-- 触发按钮 -->
                        <div class="relative">
                            <button type="button" id="coal-select-btn"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md text-left bg-white hover:bg-gray-50 flex justify-between items-center">
                                <span id="selected-coals-text">全部原煤</span>
                                <i class="fa fa-chevron-down"></i>
                            </button>

                            <!-- 弹出层 -->
                            <div id="coal-select-modal"
                                 class="hidden absolute top-full left-0 right-0 mt-3 bg-white border border-gray-300 rounded-md shadow-lg z-50 max-h-[550px] overflow-auto">
                                <table class="min-w-full">
                                    <thead>
                                    <tr class="bg-gray-100">
                                        <th class="py-3 px-4 border text-center">选择</th>
                                        <th class="py-3 px-4 border">名称</th>
                                        <th class="py-3 px-4 border">发热量</th>
                                        <th class="py-3 px-4 border">价格</th>
                                        <th class="py-3 px-4 border">境内</th>
                                    </tr>
                                    </thead>
                                    <tbody id="coal-select-table">
                                    <!-- 动态加载原煤数据 -->
                                    </tbody>
                                </table>
                                <div class="p-4 bg-gray-50 flex justify-between border-t">
                                    <button type="button" id="select-all-coals"
                                            class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                        全选
                                    </button>
                                    <button type="button" id="clear-all-coals"
                                            class="px-4 py-2 text-sm bg-gray-500 text-white rounded-md hover:bg-gray-600">
                                        清空
                                    </button>
                                    <button type="button" id="confirm-coal-selection"
                                            class="px-4 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700">
                                        确认
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit"
                        class="bg-yellow-500 text-white px-6 py-2 rounded-md hover:bg-yellow-600">
                    <i class="fa fa-bolt mr-1"></i>计算电煤配比
                </button>
            </form>
        </div>

        <!-- 电煤多方案结果（桶形展示） -->
        <div id="electric-result" class="bg-white rounded-lg shadow-md p-4 mt-6 hidden">
            <h2 class="text-xl font-semibold mb-4">电煤配比方案（按成本排序）</h2>
            <div id="electric-plan-list" class="space-y-4"></div>
        </div>
    </div>

    <!-- 计算结果面板 -->
    <div id="panel-result" class="tab-panel hidden">
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <h2 class="text-xl font-semibold mb-4">配煤指标结果</h2>
            <div id="result-indicators"
                 class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-md">
                <!-- 结果指标将通过JS动态加载 -->
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-4">
            <h2 class="text-xl font-semibold mb-4">配煤比例</h2>
            <div class="h-64">
                <canvas id="ratio-chart"></canvas>
            </div>
            <div id="ratio-table" class="mt-6">
                <!-- 比例表格将通过JS动态加载 -->
            </div>
        </div>
    </div>
</main>

<footer class="bg-gray-800 text-white p-4 mt-8">
    <div class="container mx-auto text-center text-sm">
        <p>南戈壁 审计法务中心 &copy; 2025</p>
    </div>
</footer>

<!-- 关键：所有 JS 移到 app.js -->
<script src="/static/js/app.js"></script>

</body>
</html>